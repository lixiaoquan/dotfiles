#!/bin/bash
# This is a tool to sync tools between different home
get_abs_filename() {
  # $1 : relative filename
  echo "$(cd "$(dirname "$1")" && pwd)/$(basename "$1")"
}
full_path=$(get_abs_filename $1)
read -p "Are you sure to sync $full_path ? " -n 1 -r
echo   # (optional) move to a new Line
if [[ $REPLY =~ ^[Yy]$ ]]
then
  RSYNC='rsync -avRPIO --ignore-errors'

  machines="10.21.12.24 10.28.12.231 10.21.12.17"

  for addr in $machines; do
    result=$(ifconfig)
    if [[ "$result" == *"$addr"* ]]; then
      echo "skip" $addr
    else
      $RSYNC $full_path ${addr}:/
    fi
  done
fi
